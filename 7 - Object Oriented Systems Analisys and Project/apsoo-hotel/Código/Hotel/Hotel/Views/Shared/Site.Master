<%@ Master Language="C#" Inherits="System.Web.Mvc.ViewMasterPage" %>

<%@ Import Namespace="Hotel.Models" %>
<%@ Import Namespace="Hotel.Models.Repository" %>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title>
        <asp:ContentPlaceHolder ID="TitleContent" runat="server" />
    </title>
    
    <style type="text/css">
            /* css for timepicker */
        #ui-timepicker-div dl{ text-align: left; }
        #ui-timepicker-div dl dt{ height: 25px; }
        #ui-timepicker-div dl dd{ margin: -25px 0 10px 65px; }        
    </style>
    
    <script src="<%=ResolveUrl("~")%>Scripts/jquery-1.3.2.js" type="text/javascript"></script>
    <script src="<%=ResolveUrl("~")%>Scripts/jquery-1.3.2.min.js" type="text/javascript"></script>
    
    <script src="<%=ResolveUrl("~")%>Scripts/jquery-ui-1.8.custom.min.js" type="text/javascript"></script>
    <script src="<%=ResolveUrl("~")%>Scripts/jquery-ui-timepicker-addon-0.3.js" type="text/javascript"></script>    
     
    <link href="<%=ResolveUrl("~")%>Scripts/jquery-ui-1.7.2/themes/redmond/jquery-ui-1.7.2.custom.css"
        rel="stylesheet" type="text/css" />
    <link href="<%=ResolveUrl("~")%>Content/Site.css" rel="stylesheet" type="text/css" />

  <asp:ContentPlaceHolder ID="JavaScriptContent" runat="server" />
    <script type="text/javascript">
	    function resolveUrl(relativeUrl) {	        
		    var webAppRoot="<%= ResolveUrl("~") %>";
		    var absoluteUrl;
			
		    if (relativeUrl=="~")
			    absoluteUrl=webAppRoot;
		    else
			    absoluteUrl=relativeUrl.replace("~/", webAppRoot);
				
		    //alert(relativeUrl + ", " + absoluteUrl);
		    return absoluteUrl;
	    }
		
	    jQuery(document).ready(function() {
	    
	     $('.with-date-month-picker').datepicker( {
            changeMonth: true,
            changeYear: true,
            showButtonPanel: true,
            dateFormat: 'mm/yy',
            onClose: function(dateText, inst) { 
                var month = $("#ui-datepicker-div .ui-datepicker-month :selected").val();
                var year = $("#ui-datepicker-div .ui-datepicker-year :selected").val();
                $(this).datepicker('setDate', new Date(year, month, 1));
            }
        });
		    $(".with-date-picker").datepicker({dateFormat: 'dd/mm/yy', changeYear: true});			    
		    
		    $(".with-date-time-picker").datetimepicker({dateFormat: 'dd/mm/yy', changeYear: true});			    
		    
		    if ($('#status-line').is(':visible')) {
			    setTimeout(function() {
				    $('#status-line').fadeOut('slow');
			    }, 3000);
		    }
	    }); 
    </script>

 <asp:ContentPlaceHolder ID="CssContent" runat="server" />
    
    <style type="text/css">
        #status-line
        {
            position: absolute;
            left: 41%;
            right: 57%;
            white-space: nowrap;
            display: table;
            margin: auto;
            padding: 5px 10px 5px 10px;
            text-align: center;
            top: 210px;
            height: 15px;
        }
    </style>
  

   

    <asp:ContentPlaceHolder ID="HeadContent" runat="server" />
</head>
<% IRepository<Inn,hotelEntities> hr = new EFRepository<Inn,hotelEntities>();
   Inn hotel = hr.SelectAll().First();%>
<body>
    <div class="page">
        <div id="header">
            <table width="100%">
                <tr>
                    <td>
                        <div id="title">
                            <table>
                                <tr>
                                    <td valign="top">
                                        <img alt="logo" src="<%=ResolveUrl("~")%><%=Html.Encode(hotel.Logo)%>" title="<%=Html.Encode(hotel.Name) %>"
                                            style="height: 101px; width: 149px" />
                                    </td>
                                    <td valign="top">
                                        <h1 style="vertical-align: top; height: 28px;">
                                            <%=Html.Encode(hotel.Name) %>
                                        </h1>
                                        <h2 style="color: white; vertical-align: text-top; height: 14px;">
                                            <%=Html.Encode(hotel.Description) %>
                                        </h2>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </td>
                    <td valign="top" align="right">
                        <div id="logindisplay">
                            <% Html.RenderPartial("LogOnUserControl"); %>
                        </div>
                    </td>
                </tr>
            </table>
            <div id="menucontainer">
                <ul id="menu">
                    <li>
                        <%= Html.ActionLink("Home", "Index", "Home")%></li>
                        <%  InheritRepository<Client,Person,hotelEntities> cr = new InheritRepository<Client,Person,hotelEntities>();
                            InheritRepository<Employee, Person, hotelEntities> er = new InheritRepository<Employee, Person, hotelEntities>();
                    try {
                    Client cli = cr.SelectOne(e => e.Login == HttpContext.Current.User.Identity.Name);
                    Employee emp = er.SelectOne(e => e.Login == HttpContext.Current.User.Identity.Name);
                    if (cli != null && emp == null && !String.IsNullOrEmpty(HttpContext.Current.User.Identity.Name))
                    { %>                        
                    <li>
                        <%= Html.ActionLink("Reservation", "Add/OnlineReservation", "Check", new {clientId = cli.ID }, new { @title = "Make your reservation here"})%></li>
                    <%} else if (emp != null && !String.IsNullOrEmpty(HttpContext.Current.User.Identity.Name)){
                        %>
                        <li>
                       <%= Html.ActionLink("Reservation", "Add/Reservation", "Check")%></li>
                    <% } %>
                    <% } catch (Exception ex) {%>
                    <script type="text/javascript">
                         alert(<%= ex.Message %>);
                     </script>   
                    <% }%>                    
                    <%  
                    try{
                    Employee emp = er.SelectOne(e => e.Login == HttpContext.Current.User.Identity.Name);
                    if (emp != null && !String.IsNullOrEmpty(HttpContext.Current.User.Identity.Name))
                    { %>                    
                    <li>
                        <%= Html.ActionLink("Check-In", "List/Checkin", "Check")%></li>
                    <li>
                        <%= Html.ActionLink("Check-Out", "List/Checkout", "Check")%></li>
                    <li>                    
                        <%= Html.ActionLink("Control", "Index", "Control") %>
                    </li>
                    <% 
                        if (emp.Type == 3) { %>
                        <li>
                        <%= Html.ActionLink("Administration", "Index", "Admin") %>
                        </li>
                       <% } 
                    } 
                    }
                    catch(Exception ex){ %>
                     <script type="text/javascript">
                         alert(<%= ex.Message %>);
                     </script>   
                   <% }%>
                </ul>
            </div>
            <% if (TempData["StatusLine"] != null) { %>
                <div id="status-line" class="ui-state-highlight">
                    <%= TempData["StatusLine"]%>
                    <% TempData["StatusLine"] = null;%>
                </div>
                <% } %>
            <div id="main">
                <asp:ContentPlaceHolder ID="MainContent" runat="server" />
            </div>
        </div>
    </div>
</body>
<div id="footer">
    <%=Html.Encode(hotel.Address) %>
</div>
</html>


