<html><head><title>Transformações geométricas</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta content="MSHTML 6.00.2722.900" name="GENERATOR"><link title="Introdução à computação gráfica com OpenGL" href="http://www.ceset.unicamp.br/%7Emagic/opengl/index2006.html" rel="HOME"><link title="Exercícios" href="http://www.ceset.unicamp.br/%7Emagic/opengl/transformacoes.html" rel="PREVIOUS"><link title="Outros" programas="" relacionados="" href="http://www.ceset.unicamp.br/%7Emagic/opengl/transformacoes-outros.html" rel="NEXT"></head><body text="#000000" bgcolor="#ffffff">
<div class="NAVHEADER">
<table width="100%" border="0" cellpadding="0" cellspacing="0">
  <tbody>
  <tr>
    <th colspan="3" align="middle">Introdução à computação gráfica com 
OpenGL</th></tr>
  <tr>
    <td valign="bottom" width="10%" align="left"><a href="http://www.ceset.unicamp.br/%7Emagic/opengl/transformacoes.html">Prev</a></td>
    <td valign="bottom" width="80%" align="middle"></td>
    <td valign="bottom" width="10%" align="right"><a href="http://www.ceset.unicamp.br/%7Emagic/opengl/transformacoes-outros.html">Next</a></td></tr></tbody></table>
<hr width="100%" align="left">
</div>
<div class="CHAPTER">
<h1><a name="TRANSFORMACOES">4.2. Transformações geométricas - braço robótico</a></h1>
<p>O propósito desta lição é compreender como as transformações geométricas são 
realizadas sobre os objetos em relação a um determinado sistema de coordenadas. 
No OpenGL existem funções para realizar translação, rotação e escalamento, 
bastando apenas ao usuário ajustar os seus parâmetros para obter o efeito 
desejado. Será analisado um modelo simples de um braço robótico, constituído de 
braço e antebraço, como mostra a <a href="http://www.ceset.unicamp.br/%7Emagic/opengl/transformacoes.html#FIG-BRACO">Figura 
4-1</a></p>
<div class="FIGURE">
<p><b><a name="FIG-BRACO">Figura 4-1. Braço robótico</a></b></p>
<p></p><font color="red"><font color="red"><font color="red"></font></font></font>
<p><img src="4.2.transformacoes-braco_arquivos/braco.jpg"></p></div>
<p> <b>ATENÇÃO: </b>Como este programa inclui movimentos de rotação a partir de eixos
bem definidos, recomeda-se que o aluno veja primeiro o programa <a href="http://www.ceset.unicamp.br/%7Emagic/opengl/cubos4.c" target="_top"><tt class="FILENAME">cubos4.c</tt></a>,
apresentado na Seção <a href="http://www.ceset.unicamp.br/%7Emagic/opengl/transformacoes-outros.html">Outros programas relacionados</a>.</p><p>
</p><p>O programa que implementa o braço robótico é mostrado no <a href="http://www.ceset.unicamp.br/%7Emagic/opengl/transformacoes.html#EXAMPLE-BRACO">Exemplo 
4-1</a>. As teclas <b class="KEYCAP">s</b> e <b class="KEYCAP">S</b> servem para 
girar o ombro do braço robótico (<i class="FOREIGNPHRASE">shoulder</i>) para um 
lado e para o outro; as teclas <b class="KEYCAP">e</b> e <b class="KEYCAP">E</b>, 
por sua vez, controlam o giro do cotovelo (<i class="FOREIGNPHRASE">elbow</i>). 
Para finalizar o programa, basta digitar <b class="KEYCAP">ESC</b>. As teclas e 
suas respectivas ações estão definidas na função <tt class="FUNCTION">keyboard()</tt>.</p>
<div class="EXAMPLE">
<p><b><a name="EXAMPLE-BRACO">Exemplo 4-1. programa </a><a href="http://www.ceset.unicamp.br/%7Emagic/opengl/braco.c" target="_top"><tt class="FILENAME">braco.c</tt></a></b></p>
<table width="100%" bgcolor="#e0e0e0" border="0">
  <tbody>
  <tr>
    <td><pre class="PROGRAMLISTING">#include &lt;GL/glut.h&gt;
#include &lt;stdlib.h&gt;

static int shoulder = 0, elbow = 0;

void init(void){
  glClearColor (0.0, 0.0, 0.0, 0.0);
}

void display(void){
  glClear (GL_COLOR_BUFFER_BIT);
  glPushMatrix();

  /* origem posicionada no ombro */
  glTranslatef (-1.0, 0.0, 0.0);
  glRotatef ((GLfloat) shoulder, 0.0, 0.0, 1.0);

  /* origem posicionada no centro do braço */ 
  glTranslatef (1.0, 0.0, 0.0);
  glPushMatrix();
  glScalef (2.0, 0.4, 1.0);
  glutWireCube (1.0);
  glPopMatrix();
   
  /* origem posicionada no cotovelo */
  glTranslatef (1.0, 0.0, 0.0);
  glRotatef ((GLfloat) elbow, 0.0, 0.0, 1.0);
  glTranslatef (1.0, 0.0, 0.0);
  glPushMatrix();
  glScalef (2.0, 0.4, 1.0);
  glutWireCube (1.0);
  glPopMatrix();

  /* origem volta para o sistema de coordenadas original */
  glPopMatrix();
  glutSwapBuffers();
}

void reshape (int w, int h){
  glViewport (0, 0, (GLsizei) w, (GLsizei) h);
  glMatrixMode (GL_PROJECTION);
  glLoadIdentity ();
  gluPerspective(65.0, (GLfloat) w/(GLfloat) h, 1.0, 20.0);
  glMatrixMode(GL_MODELVIEW);
  glLoadIdentity();
  glTranslatef (0.0, 0.0, -5.0);
}

void keyboard (unsigned char key, int x, int y){
  switch (key) {
  case 's':
    shoulder = (shoulder + 5) % 360;
    glutPostRedisplay();
    break;
  case 'S':
    shoulder = (shoulder - 5) % 360;
    glutPostRedisplay();
    break;
  case 'e':
    elbow = (elbow + 5) % 360;
    glutPostRedisplay();
    break;
  case 'E':
    elbow = (elbow - 5) % 360;
    glutPostRedisplay();
    break;
  case 27:
    exit(0);
    break;
  default:
    break;
  }
}

int main(int argc, char** argv){
  glutInit(&amp;argc, argv);
  glutInitDisplayMode (GLUT_DOUBLE | GLUT_RGB);
  glutInitWindowSize (500, 500); 
  glutInitWindowPosition (100, 100);
  glutCreateWindow (argv[0]);
  init ();
  glutDisplayFunc(display); 
  glutReshapeFunc(reshape);
  glutKeyboardFunc(keyboard);
  glutMainLoop();
  return 0;
}</pre></td></tr></tbody></table></div>
<p>Para compilar e executar o programa <a href="http://www.ceset.unicamp.br/%7Emagic/opengl/braco.c" target="_top"><tt class="FILENAME">braco.c</tt></a>, salve-o juntamente com o 
arquivo <a href="http://www.ceset.unicamp.br/%7Emagic/opengl/Makefile" target="_top">Makefile</a> em um diretório e execute a seguinte seqüência de 
comandos:</p>
<table width="100%" bgcolor="#e0e0e0" border="0">
  <tbody>
  <tr>
    <td><pre class="SCREEN"><tt class="PROMPT">$</tt> <b class="COMMAND">make</b> <span class="OPTION">braco</span>
<tt class="PROMPT">$</tt> <b class="COMMAND">./braco</b></pre></td></tr></tbody></table>
<div class="SECT1">
<h1 class="SECT1"><a name="TRANSFORMACOES-DESCRICAO">4.2.1. Descrição do programa <tt class="FILENAME">braco.c</tt></a></h1>
<div class="INFORMALEXAMPLE">
<p></p>
<table width="100%" bgcolor="#e0e0e0" border="0">
  <tbody>
  <tr>
    <td><pre class="PROGRAMLISTING">static int shoulder = 0, elbow = 0;</pre></td></tr></tbody></table>
<p></p></div>
<p>As variáveis <font color="red">shoulder</font> e <font color="red">elbow</font> 
guardam o ângulo de rotação do ombro e o ângulo formado entre o braço e o 
antebraço do robô, respectivamente.</p>
<div class="INFORMALEXAMPLE">
<p></p>
<table width="100%" bgcolor="#e0e0e0" border="0">
  <tbody>
  <tr>
    <td><pre class="PROGRAMLISTING">void display(void)
{
  glClear (GL_COLOR_BUFFER_BIT);
  glPushMatrix();</pre></td></tr></tbody></table>
<p></p></div>
<p>Uma vez que as transformações geométricas no espaço são representadas por 
matrizes, o uso de uma pilha de matrizes de transformação ajuda a lembrar a 
seqüência de transformações realizadas. No OpenGL, esta facilidade é provida 
pelas funções <tt class="FUNCTION">glPushMatrix()</tt>, que insere a matriz de 
transformação corrente na pilha, e <tt class="FUNCTION">glPopMatrix()</tt>, que 
retira a matriz do topo da pilha e torna esta última a matriz de transformação 
corrente. Neste exemplo, a função <tt class="FUNCTION">glPushMatrix()</tt> serve 
para lembrar os parâmetros de translação, rotação e escalamento no início das 
operações de desenho.</p>
<div class="INFORMALEXAMPLE">
<p></p>
<table width="100%" bgcolor="#e0e0e0" border="0">
  <tbody>
  <tr>
    <td><pre class="PROGRAMLISTING">  glTranslatef (-1.0, 0.0, 0.0);
  glRotatef ((GLfloat) shoulder, 0.0, 0.0, 1.0);
  glTranslatef (1.0, 0.0, 0.0);</pre></td></tr></tbody></table>
<p></p></div>
<p>A origem do sistema de coordenadas é levado para o ponto (x,y,z)=(-1,0,0) 
através da função <tt class="FUNCTION">glTranslatef()</tt>, definindo a coordenada 
de origem (pivô) para o ombro do braço robótico. Em seguida, usando a função <tt class="FUNCTION">glRotatef()</tt>, o sistema de coordenadas é rotacionado de modo, 
definindo a orientação do braço.</p>
<p>A função <tt class="FUNCTION">glRotate()</tt> possui o seguinte protótipo:</p>
<div class="FUNCSYNOPSIS">
<p></p>
<p><code><code class="FUNCDEF">void glRotate</code>(GLfloat angle, GLfloat x, 
GLfloat y, GLfloat z);</code></p>
<p></p></div>
<p>Quando chamada, <tt class="FUNCTION">glRotate()</tt> efetua uma rotação de <tt class="PARAMETER"><i>angle</i></tt> graus no sistema de coordenadas na direção 
contra o sentido do relógio em torno de um vetor que vai da origem ao ponto 
(x,y,z)</p>
<p>A função <tt class="FUNCTION">glTranslatef()</tt>, por sua vez, retorna a 
origem do sistema de coordenadas para o centro do braço. As etapas desta 
transformação são mostradas na <a href="http://www.ceset.unicamp.br/%7Emagic/opengl/transformacoes.html#FIG-BRACO-1">Figura 
4-2</a>.</p>
<div class="FIGURE">
<p><b><a name="FIG-BRACO-1">Figura 4-2. Transformação para desenho do 
braço</a></b></p>
<p><img src="4.2.transformacoes-braco_arquivos/braco-1.jpg"></p></div>
<div class="INFORMALEXAMPLE">
<p></p>
<table width="100%" bgcolor="#e0e0e0" border="0">
  <tbody>
  <tr>
    <td><pre class="PROGRAMLISTING">  glPushMatrix();
  glScalef (2.0, 0.4, 1.0);
  glutWireCube (1.0);
  glPopMatrix();</pre></td></tr></tbody></table>
<p></p></div>
<p>Mais uma vez, a matriz de transformação corrente é armazenada na pilha, agora 
para restringir o efeito da função <tt class="FUNCTION">glScale()</tt>. A função 
<tt class="FUNCTION">glScale()</tt> altera a escala dos eixos x, y e z. A função 
<tt class="FUNCTION">glutWireCube()</tt> desenha um cubo centrado na origem do 
sistema de coordenadas com aresta de tamanho unitário, conforme o argumento que 
lhe foi passado. Quando a função <tt class="FUNCTION">glPopMatrix()</tt> é 
chamada, a matriz de transformação do topo da pilha passa a vigorar, fazendo com 
que o cubo seja distorcido, assumindo a forma de um parelepípedo. A origem do 
sistema de coordenadas volta a ser o centro do braço.</p>
<div class="INFORMALEXAMPLE">
<p></p>
<table width="100%" bgcolor="#e0e0e0" border="0">
  <tbody>
  <tr>
    <td><pre class="PROGRAMLISTING">  glTranslatef (1.0, 0.0, 0.0);
  glRotatef ((GLfloat) elbow, 0.0, 0.0, 1.0);
  glTranslatef (1.0, 0.0, 0.0);</pre></td></tr></tbody></table>
<p></p></div>
<p>A origem do sistema de coordenadas é levada agora para a ponta do braço com a 
função <tt class="FUNCTION">glTranslate()</tt>, demarcando o novo pivõ para 
rotação: o cotovelo do robô. A rotação é realizada com a função <tt class="FUNCTION">glRotate()</tt> e em seguida a origem do sistema de coordenadas é 
levada para o centro do antebraço, via <tt class="FUNCTION">glTranslate()</tt>.</p>
<div class="INFORMALEXAMPLE">
<p></p>
<table width="100%" bgcolor="#e0e0e0" border="0">
  <tbody>
  <tr>
    <td><pre class="PROGRAMLISTING">  glPushMatrix();
  glScalef (2.0, 0.4, 1.0);
  glutWireCube (1.0);
  glPopMatrix();</pre></td></tr></tbody></table>
<p></p></div>
<p>O antebraço é desenhado de forma semelhante ao braço: as escalas dos eixos 
coordenados são ajustadas e o cubo de aresta 1 é desenhado, sempre preservando 
as dimensões do sistema de coordenadas original.</p>
<div class="INFORMALEXAMPLE">
<p></p>
<table width="100%" bgcolor="#e0e0e0" border="0">
  <tbody>
  <tr>
    <td><pre class="PROGRAMLISTING">  glPopMatrix();
  glutSwapBuffers();</pre></td></tr></tbody></table>
<p></p></div>
<p>A função <tt class="FUNCTION">glPopMatrix()</tt> remove a matriz de 
transformação do topo da pilha, fazendo-a corrente, retornando assim o sistema 
de coordenadas original. Quando <tt class="FUNCTION">glutSwapBuffers()</tt> é 
chamada, os buffers de desenho e de apresentação são alternados e a nova imagem 
do braço robótico é apresentada.</p>
<div class="INFORMALEXAMPLE">
<p></p>
<table width="100%" bgcolor="#e0e0e0" border="0">
  <tbody>
  <tr>
    <td><pre class="PROGRAMLISTING">void reshape (int w, int h)
{
  glViewport (0, 0, (GLsizei) w, (GLsizei) h); </pre></td></tr></tbody></table>
<p></p></div>
<p>Define a área dentro da janela de desenho no sistema de coordenadas atual, 
origem (x,y), largura (w) e altura (h), que OpenGL pode utilizar para efetuar 
desenhos. Este trecho de código permite que toda a área da janela possa ser 
utilizada quando a janela sofrer redimensionamento.</p>
<div class="INFORMALEXAMPLE">
<p></p>
<table width="100%" bgcolor="#e0e0e0" border="0">
  <tbody>
  <tr>
    <td><pre class="PROGRAMLISTING">  glMatrixMode (GL_PROJECTION);
  glLoadIdentity ();
  gluPerspective(65.0, (GLfloat) w/(GLfloat) h, 1.0, 20.0);</pre></td></tr></tbody></table>
<p></p></div>
<p>A função <tt class="FUNCTION">glMatrixMode()</tt> especifica a pilha de 
matrizes que será o alvo das operações matriciais subseqüentes; neste caso, a 
pilha de matrizes de projeção. A função <tt class="FUNCTION">glLoadIdentity()</tt> 
inicia a matriz de projeção corrente como a matriz identidade. A função <tt class="FUNCTION">gluPerspective()</tt> define a transformação de perspectiva usada 
no exemplo. Projeções geométricas não são alvo desta lição e por enquanto não 
serão estudadas.</p>
<div class="INFORMALEXAMPLE">
<p></p>
<table width="100%" bgcolor="#e0e0e0" border="0">
  <tbody>
  <tr>
    <td><pre class="PROGRAMLISTING">  glMatrixMode(GL_MODELVIEW);
  glLoadIdentity();
  glTranslatef (0.0, 0.0, -5.0);</pre></td></tr></tbody></table>
<p></p></div>
<p>A função <tt class="FUNCTION">glMatrixMode()</tt> especifica agora que a pilha 
de matrizes de <i class="FOREIGNPHRASE">modelview</i>, usadas para definir 
translação, rotação e escalamento, será o alvo das transformações subseqüentes. 
A função <tt class="FUNCTION">glLoadIdentity()</tt> inicia a matriz de <i class="FOREIGNPHRASE">modelview</i> corrente como a matriz identidade. Finalmente, 
o objeto é deslocado -5 unidades para o fundo da tela, melhorando a sua 
visualização.</p>
<div class="INFORMALEXAMPLE">
<p></p>
<table width="100%" bgcolor="#e0e0e0" border="0">
  <tbody>
  <tr>
    <td><pre class="PROGRAMLISTING">  glutReshapeFunc(reshape);</pre></td></tr></tbody></table>
<p></p></div>
<p>Especifica a função de retorno para redimensionamento de janela, possuindo o 
seguinte protótipo:</p>
<div class="FUNCSYNOPSIS">
<p></p>
<p><code><code class="FUNCDEF">funcao</code>(int width, int height);</code></p>
<p></p></div></div></div>
<div class="NAVFOOTER">
<hr width="100%" align="left">

<table width="100%" border="0" cellpadding="0" cellspacing="0">
  <tbody>
  <tr>
    <td valign="top" width="33%" align="left"><a href="http://www.ceset.unicamp.br/%7Emagic/opengl/transformacoes.html">Prev</a></td>
    <td valign="top" width="34%" align="middle"><a href="http://www.ceset.unicamp.br/%7Emagic/opengl/index2006.html">Home</a></td>
    <td valign="top" width="33%" align="right"><a href="http://www.ceset.unicamp.br/%7Emagic/opengl/transformacoes-outros.html">Next</a></td></tr>
  <tr>
    <td valign="top" width="33%" align="left">Transformações</td>
    <td valign="top" width="34%" align="middle">&nbsp;</td>
    <td valign="top" width="33%" align="right">Outros programas relacionados</td></tr></tbody></table></div></body></html>